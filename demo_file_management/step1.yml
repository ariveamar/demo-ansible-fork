---
- name: Perform Step 1 file check
  hosts: "{{ target_group }}"
  become: yes
  gather_facts: yes
  
  tasks:
  - debug:
      msg: "Starting Logging for {{ target_group }}"

  - name: set log var fact
    set_fact:
    log1: "{{ audit_f/ftp_3/testing/log/{{ date }}.testing.log"
  
  - debug:
      msg: "Test var {{ log1 }}"

  - name: Create initial log file
    file: 
      path: "{{ log1 }}"
      state: touch
    
  - name: create log into log file
    lineinfile:
      path: "{{ log1 }}"
      line: log created at {{ date }} for testing

  - name: Check if dir1 is exists
    stat:
      path: "{{ dir1 }}"
    register: dir1_status

  - name: Check if dir2 is exists
    stat:
      path: "{{ dir2 }}"
    register: dir2_status

  - name: Load roles when both directory is available
    include_role:
      name: "copy_merge"
    when: dir1_status.stat.exists and dir2_status.stat.exists

  - name: Fail when both directory is missing
    fail:
      msg: "Both directory is missing!!"
    when: dir1_status.stat.exists == False and dir2_status.stat.exists == False

  - name: Fail when dir1 is missing
    fail:
      msg: "Directory dir1 is missing"
    when: dir1_status.stat.exists == False

  - name: Fail when dir2 is missing
    fail:
      msg: "Directory dir2 is missing"
    when: dir2_status.stat.exists == False

