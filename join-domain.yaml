---
  - name: create user
    hosts: all
    collections:
      - ansible.windows
    gather_facts: no
    tasks:

    - ansible.windows.win_domain_membership:
        dns_domain_name: virtus.demo
        hostname: virtus.demo
        domain_admin_user: adminstrator@virtus.demo
        domain_admin_password: "{{ var_password }}"
        domain_ou_path: "DC=virtus,DC=demo"
        state: domain
      register: domain_state
    - ansible.windows.win_reboot:
      when: domain_state.reboot_required
