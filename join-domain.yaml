---
  - name: create user
    hosts: all
    gather_facts: no
    tasks:
      - win_domain_membership:
          dns_domain_name: virtus.demo
          hostname: server1
          domain_admin_user: administrator@virtus.demo
          domain_admin_password: "{{ var_password }}"
          domain_ou_path: "DC=virtus,DC=demo"
          state: domain
        register: domain_state
      - win_reboot:
        when: domain_state.reboot_required
